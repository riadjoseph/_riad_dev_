{"version":3,"file":"customizations.full.js","sources":["../src/utils/globals.ts","../src/config.ts","../src/utils/string-utils.ts","../src/utils/type-utils.ts","../src/utils/logger.ts","../src/utils/index.ts","../src/utils/request-utils.ts","../src/utils/user-agent-utils.ts","../src/utils/event-utils.ts","../src/utils/number-utils.ts","../src/extensions/sampling.ts","../src/customizations/before-send.ts","../src/customizations/setAllPersonProfilePropertiesAsPersonPropertiesForFlags.ts","../src/entrypoints/customizations.full.ts"],"sourcesContent":["import type { PostHog } from '../posthog-core'\nimport { SessionIdManager } from '../sessionid'\nimport { DeadClicksAutoCaptureConfig, Properties, RemoteConfig, SiteAppLoader } from '../types'\n\n/*\n * Global helpers to protect access to browser globals in a way that is safer for different targets\n * like DOM, SSR, Web workers etc.\n *\n * NOTE: Typically we want the \"window\" but globalThis works for both the typical browser context as\n * well as other contexts such as the web worker context. Window is still exported for any bits that explicitly require it.\n * If in doubt - export the global you need from this file and use that as an optional value. This way the code path is forced\n * to handle the case where the global is not available.\n */\n\n// eslint-disable-next-line no-restricted-globals\nconst win: (Window & typeof globalThis) | undefined = typeof window !== 'undefined' ? window : undefined\n\nexport type AssignableWindow = Window &\n    typeof globalThis & {\n        __PosthogExtensions__?: PostHogExtensions\n\n        _POSTHOG_REMOTE_CONFIG?: Record<\n            string,\n            {\n                config: RemoteConfig\n                siteApps: SiteAppLoader[]\n            }\n        >\n\n        doNotTrack: any\n        posthogCustomizations: any\n        posthogErrorWrappingFunctions: any\n        rrweb: any\n        rrwebConsoleRecord: any\n        getRecordNetworkPlugin: any\n        POSTHOG_DEBUG: any\n        posthog: any\n        ph_load_toolbar: any\n        ph_load_editor: any\n        ph_toolbar_state: any\n        postHogWebVitalsCallbacks: any\n        postHogTracingHeadersPatchFns: any\n        extendPostHogWithSurveys: any\n    } & Record<`__$$ph_site_app_${string}`, any>\n\n/**\n * This is our contract between (potentially) lazily loaded extensions and the SDK\n * changes to this interface can be breaking changes for users of the SDK\n */\n\nexport type PostHogExtensionKind =\n    | 'toolbar'\n    | 'exception-autocapture'\n    | 'web-vitals'\n    | 'recorder'\n    | 'tracing-headers'\n    | 'surveys'\n    | 'dead-clicks-autocapture'\n    | 'remote-config'\n\nexport interface LazyLoadedDeadClicksAutocaptureInterface {\n    start: (observerTarget: Node) => void\n    stop: () => void\n}\n\ninterface PostHogExtensions {\n    loadExternalDependency?: (\n        posthog: PostHog,\n        kind: PostHogExtensionKind,\n        callback: (error?: string | Event, event?: Event) => void\n    ) => void\n\n    loadSiteApp?: (posthog: PostHog, appUrl: string, callback: (error?: string | Event, event?: Event) => void) => void\n\n    errorWrappingFunctions?: {\n        wrapOnError: (captureFn: (props: Properties) => void) => () => void\n        wrapUnhandledRejection: (captureFn: (props: Properties) => void) => () => void\n        wrapConsoleError: (captureFn: (props: Properties) => void) => () => void\n    }\n    rrweb?: { record: any; version: string }\n    rrwebPlugins?: { getRecordConsolePlugin: any; getRecordNetworkPlugin?: any }\n    generateSurveys?: (posthog: PostHog) => any | undefined\n    postHogWebVitalsCallbacks?: {\n        onLCP: (metric: any) => void\n        onCLS: (metric: any) => void\n        onFCP: (metric: any) => void\n        onINP: (metric: any) => void\n    }\n    tracingHeadersPatchFns?: {\n        _patchFetch: (sessionManager?: SessionIdManager) => () => void\n        _patchXHR: (sessionManager?: SessionIdManager) => () => void\n    }\n    initDeadClicksAutocapture?: (\n        ph: PostHog,\n        config: DeadClicksAutoCaptureConfig\n    ) => LazyLoadedDeadClicksAutocaptureInterface\n}\n\nconst global: typeof globalThis | undefined = typeof globalThis !== 'undefined' ? globalThis : win\n\nexport const ArrayProto = Array.prototype\nexport const nativeForEach = ArrayProto.forEach\nexport const nativeIndexOf = ArrayProto.indexOf\n\nexport const navigator = global?.navigator\nexport const document = global?.document\nexport const location = global?.location\nexport const fetch = global?.fetch\nexport const XMLHttpRequest =\n    global?.XMLHttpRequest && 'withCredentials' in new global.XMLHttpRequest() ? global.XMLHttpRequest : undefined\nexport const AbortController = global?.AbortController\nexport const userAgent = navigator?.userAgent\nexport const assignableWindow: AssignableWindow = win ?? ({} as any)\n\nexport { win as window }\n","import packageInfo from '../package.json'\n\n// overridden in posthog-core,\n// e.g.     Config.DEBUG = Config.DEBUG || instance.config.debug\nconst Config = {\n    DEBUG: false,\n    LIB_VERSION: packageInfo.version,\n}\n\nexport default Config\n","export function includes(str: string, needle: string): boolean\nexport function includes<T>(arr: T[], needle: T): boolean\nexport function includes(str: unknown[] | string, needle: unknown): boolean {\n    return (str as any).indexOf(needle) !== -1\n}\n\nexport const trim = function (str: string): string {\n    // Previous implementation was using underscore's trim function.\n    // When switching to just using the native trim() function, we ran some tests to make sure that it was able to trim both the BOM character \\uFEFF and the NBSP character \\u00A0.\n    // We tested modern Chrome (134.0.6998.118) and Firefox (136.0.2), and IE11 running on Windows 10, and all of them were able to trim both characters.\n    // See https://posthog.slack.com/archives/C0113360FFV/p1742811455647359\n    return str.trim()\n}\n\n// UNDERSCORE\n// Embed part of the Underscore Library\nexport const stripLeadingDollar = function (s: string): string {\n    return s.replace(/^\\$/, '')\n}\n\nexport function isDistinctIdStringLike(value: string): boolean {\n    return ['distinct_id', 'distinctid'].includes(value.toLowerCase())\n}\n","import { window } from './globals'\nimport { knownUnsafeEditableEvent, KnownUnsafeEditableEvent } from '../types'\nimport { includes } from './string-utils'\n\n// eslint-disable-next-line posthog-js/no-direct-array-check\nconst nativeIsArray = Array.isArray\nconst ObjProto = Object.prototype\nexport const hasOwnProperty = ObjProto.hasOwnProperty\nconst toString = ObjProto.toString\n\nexport const isArray =\n    nativeIsArray ||\n    function (obj: any): obj is any[] {\n        return toString.call(obj) === '[object Array]'\n    }\n\n// from a comment on http://dbj.org/dbj/?p=286\n// fails on only one very rare and deliberate custom object:\n// let bomb = { toString : undefined, valueOf: function(o) { return \"function BOMBA!\"; }};\nexport const isFunction = (x: unknown): x is (...args: any[]) => any => {\n    // eslint-disable-next-line posthog-js/no-direct-function-check\n    return typeof x === 'function'\n}\n\nexport const isNativeFunction = (x: unknown): x is (...args: any[]) => any =>\n    isFunction(x) && x.toString().indexOf('[native code]') !== -1\n\n// When angular patches functions they pass the above `isNativeFunction` check (at least the MutationObserver)\nexport const isAngularZonePresent = (): boolean => {\n    return !!(window as any).Zone\n}\n\n// Underscore Addons\nexport const isObject = (x: unknown): x is Record<string, any> => {\n    // eslint-disable-next-line posthog-js/no-direct-object-check\n    return x === Object(x) && !isArray(x)\n}\nexport const isEmptyObject = (x: unknown) => {\n    if (isObject(x)) {\n        for (const key in x) {\n            if (hasOwnProperty.call(x, key)) {\n                return false\n            }\n        }\n        return true\n    }\n    return false\n}\nexport const isUndefined = (x: unknown): x is undefined => x === void 0\n\nexport const isString = (x: unknown): x is string => {\n    // eslint-disable-next-line posthog-js/no-direct-string-check\n    return toString.call(x) == '[object String]'\n}\n\nexport const isEmptyString = (x: unknown): boolean => isString(x) && x.trim().length === 0\n\nexport const isNull = (x: unknown): x is null => {\n    // eslint-disable-next-line posthog-js/no-direct-null-check\n    return x === null\n}\n\n/*\n    sometimes you want to check if something is null or undefined\n    that's what this is for\n */\nexport const isNullish = (x: unknown): x is null | undefined => isUndefined(x) || isNull(x)\n\nexport const isNumber = (x: unknown): x is number => {\n    // eslint-disable-next-line posthog-js/no-direct-number-check\n    return toString.call(x) == '[object Number]'\n}\nexport const isBoolean = (x: unknown): x is boolean => {\n    // eslint-disable-next-line posthog-js/no-direct-boolean-check\n    return toString.call(x) === '[object Boolean]'\n}\n\nexport const isDocument = (x: unknown): x is Document => {\n    // eslint-disable-next-line posthog-js/no-direct-document-check\n    return x instanceof Document\n}\n\nexport const isFormData = (x: unknown): x is FormData => {\n    // eslint-disable-next-line posthog-js/no-direct-form-data-check\n    return x instanceof FormData\n}\n\nexport const isFile = (x: unknown): x is File => {\n    // eslint-disable-next-line posthog-js/no-direct-file-check\n    return x instanceof File\n}\n\nexport const isError = (x: unknown): x is Error => {\n    return x instanceof Error\n}\n\nexport const isKnownUnsafeEditableEvent = (x: unknown): x is KnownUnsafeEditableEvent => {\n    return includes(knownUnsafeEditableEvent as unknown as string[], x)\n}\n","import Config from '../config'\nimport { isUndefined } from './type-utils'\nimport { assignableWindow, window } from './globals'\n\nexport type Logger = {\n    _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => void\n    info: (...args: any[]) => void\n    warn: (...args: any[]) => void\n    error: (...args: any[]) => void\n    critical: (...args: any[]) => void\n    uninitializedWarning: (methodName: string) => void\n    createLogger: (prefix: string) => Logger\n}\n\nconst _createLogger = (prefix: string): Logger => {\n    const logger: Logger = {\n        _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => {\n            if (\n                window &&\n                (Config.DEBUG || assignableWindow.POSTHOG_DEBUG) &&\n                !isUndefined(window.console) &&\n                window.console\n            ) {\n                const consoleLog =\n                    '__rrweb_original__' in window.console[level]\n                        ? (window.console[level] as any)['__rrweb_original__']\n                        : window.console[level]\n\n                // eslint-disable-next-line no-console\n                consoleLog(prefix, ...args)\n            }\n        },\n\n        info: (...args: any[]) => {\n            logger._log('log', ...args)\n        },\n\n        warn: (...args: any[]) => {\n            logger._log('warn', ...args)\n        },\n\n        error: (...args: any[]) => {\n            logger._log('error', ...args)\n        },\n\n        critical: (...args: any[]) => {\n            // Critical errors are always logged to the console\n            // eslint-disable-next-line no-console\n            console.error(prefix, ...args)\n        },\n\n        uninitializedWarning: (methodName: string) => {\n            logger.error(`You must initialize PostHog before calling ${methodName}`)\n        },\n\n        createLogger: (additionalPrefix: string) => _createLogger(`${prefix} ${additionalPrefix}`),\n    }\n    return logger\n}\n\nexport const logger = _createLogger('[PostHog.js]')\n\nexport const createLogger = logger.createLogger\n","import { Breaker, Properties } from '../types'\nimport { nativeForEach, nativeIndexOf } from './globals'\nimport { logger } from './logger'\nimport { hasOwnProperty, isArray, isFormData, isNull, isNullish, isNumber, isString } from './type-utils'\n\nconst breaker: Breaker = {}\n\nexport function eachArray<E = any>(\n    obj: E[] | null | undefined,\n    iterator: (value: E, key: number) => void | Breaker,\n    thisArg?: any\n): void {\n    if (isArray(obj)) {\n        if (nativeForEach && obj.forEach === nativeForEach) {\n            obj.forEach(iterator, thisArg)\n        } else if ('length' in obj && obj.length === +obj.length) {\n            for (let i = 0, l = obj.length; i < l; i++) {\n                if (i in obj && iterator.call(thisArg, obj[i], i) === breaker) {\n                    return\n                }\n            }\n        }\n    }\n}\n\n/**\n * @param {*=} obj\n * @param {function(...*)=} iterator\n * @param {Object=} thisArg\n */\nexport function each(obj: any, iterator: (value: any, key: any) => void | Breaker, thisArg?: any): void {\n    if (isNullish(obj)) {\n        return\n    }\n    if (isArray(obj)) {\n        return eachArray(obj, iterator, thisArg)\n    }\n    if (isFormData(obj)) {\n        for (const pair of obj.entries()) {\n            if (iterator.call(thisArg, pair[1], pair[0]) === breaker) {\n                return\n            }\n        }\n        return\n    }\n    for (const key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n            if (iterator.call(thisArg, obj[key], key) === breaker) {\n                return\n            }\n        }\n    }\n}\n\nexport const extend = function (obj: Record<string, any>, ...args: Record<string, any>[]): Record<string, any> {\n    eachArray(args, function (source) {\n        for (const prop in source) {\n            if (source[prop] !== void 0) {\n                obj[prop] = source[prop]\n            }\n        }\n    })\n    return obj\n}\n\nexport const extendArray = function <T>(obj: T[], ...args: T[][]): T[] {\n    eachArray(args, function (source) {\n        eachArray(source, function (item) {\n            obj.push(item)\n        })\n    })\n    return obj\n}\n\nexport const include = function (\n    obj: null | string | Array<any> | Record<string, any>,\n    target: any\n): boolean | Breaker {\n    let found = false\n    if (isNull(obj)) {\n        return found\n    }\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) {\n        return obj.indexOf(target) != -1\n    }\n    each(obj, function (value) {\n        if (found || (found = value === target)) {\n            return breaker\n        }\n        return\n    })\n    return found\n}\n\n/**\n * Object.entries() polyfill\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries\n */\nexport function entries<T = any>(obj: Record<string, T>): [string, T][] {\n    const ownProps = Object.keys(obj)\n    let i = ownProps.length\n    const resArray = new Array(i) // preallocate the Array\n\n    while (i--) {\n        resArray[i] = [ownProps[i], obj[ownProps[i]]]\n    }\n    return resArray\n}\n\nexport const trySafe = function <T>(fn: () => T): T | undefined {\n    try {\n        return fn()\n    } catch {\n        return undefined\n    }\n}\n\nexport const safewrap = function <F extends (...args: any[]) => any = (...args: any[]) => any>(f: F): F {\n    return function (...args) {\n        try {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return f.apply(this, args)\n        } catch (e) {\n            logger.critical(\n                'Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A.'\n            )\n            logger.critical(e)\n        }\n    } as F\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\nexport const safewrapClass = function (klass: Function, functions: string[]): void {\n    for (let i = 0; i < functions.length; i++) {\n        klass.prototype[functions[i]] = safewrap(klass.prototype[functions[i]])\n    }\n}\n\nexport const stripEmptyProperties = function (p: Properties): Properties {\n    const ret: Properties = {}\n    each(p, function (v, k) {\n        if ((isString(v) && v.length > 0) || isNumber(v)) {\n            ret[k] = v\n        }\n    })\n    return ret\n}\n\n/**\n * Deep copies an object.\n * It handles cycles by replacing all references to them with `undefined`\n * Also supports customizing native values\n *\n * @param value\n * @param customizer\n * @returns {{}|undefined|*}\n */\nfunction deepCircularCopy<T extends Record<string, any> = Record<string, any>>(\n    value: T,\n    customizer?: <K extends keyof T = keyof T>(value: T[K], key?: K) => T[K]\n): T | undefined {\n    const COPY_IN_PROGRESS_SET = new Set()\n\n    function internalDeepCircularCopy(value: T, key?: string): T | undefined {\n        if (value !== Object(value)) return customizer ? customizer(value as any, key) : value // primitive value\n\n        if (COPY_IN_PROGRESS_SET.has(value)) return undefined\n        COPY_IN_PROGRESS_SET.add(value)\n        let result: T\n\n        if (isArray(value)) {\n            result = [] as any as T\n            eachArray(value, (it) => {\n                result.push(internalDeepCircularCopy(it))\n            })\n        } else {\n            result = {} as T\n            each(value, (val, key) => {\n                if (!COPY_IN_PROGRESS_SET.has(val)) {\n                    ;(result as any)[key] = internalDeepCircularCopy(val, key)\n                }\n            })\n        }\n        return result\n    }\n    return internalDeepCircularCopy(value)\n}\n\nexport function _copyAndTruncateStrings<T extends Record<string, any> = Record<string, any>>(\n    object: T,\n    maxStringLength: number | null\n): T {\n    return deepCircularCopy(object, (value: any) => {\n        if (isString(value) && !isNull(maxStringLength)) {\n            return (value as string).slice(0, maxStringLength)\n        }\n        return value\n    }) as T\n}\n\n// NOTE: Update PostHogConfig docs if you change this list\n// We will not try to catch all bullets here, but we should make an effort to catch the most common ones\n// You should be highly against adding more to this list, because ultimately customers can configure\n// their `cross_subdomain_cookie` setting to anything they want.\nconst EXCLUDED_FROM_CROSS_SUBDOMAIN_COOKIE = ['herokuapp.com', 'vercel.app', 'netlify.app']\nexport function isCrossDomainCookie(documentLocation: Location | undefined) {\n    const hostname = documentLocation?.hostname\n\n    if (!isString(hostname)) {\n        return false\n    }\n    // split and slice isn't a great way to match arbitrary domains,\n    // but it's good enough for ensuring we only match herokuapp.com when it is the TLD\n    // for the hostname\n    const lastTwoParts = hostname.split('.').slice(-2).join('.')\n\n    for (const excluded of EXCLUDED_FROM_CROSS_SUBDOMAIN_COOKIE) {\n        if (lastTwoParts === excluded) {\n            return false\n        }\n    }\n\n    return true\n}\n\nexport function find<T>(value: T[], predicate: (value: T) => boolean): T | undefined {\n    for (let i = 0; i < value.length; i++) {\n        if (predicate(value[i])) {\n            return value[i]\n        }\n    }\n    return undefined\n}\n\n// Use this instead of element.addEventListener to avoid eslint errors\n// this properly implements the default options for passive event listeners\nexport function addEventListener(\n    element: Window | Document | Element | undefined,\n    event: string,\n    callback: EventListener,\n    options?: AddEventListenerOptions\n): void {\n    const { capture = false, passive = true } = options ?? {}\n\n    // This is the only place where we are allowed to call this function\n    // because the whole idea is that we should be calling this instead of the built-in one\n    // eslint-disable-next-line posthog-js/no-add-event-listener\n    element?.addEventListener(event, callback, { capture, passive })\n}\n","import { each } from './'\n\nimport { isArray, isFile, isUndefined } from './type-utils'\nimport { logger } from './logger'\nimport { document } from './globals'\n\nconst localDomains = ['localhost', '127.0.0.1']\n\n/**\n * IE11 doesn't support `new URL`\n * so we can create an anchor element and use that to parse the URL\n * there's a lot of overlap between HTMLHyperlinkElementUtils and URL\n * meaning useful properties like `pathname` are available on both\n */\nexport const convertToURL = (url: string): HTMLAnchorElement | null => {\n    const location = document?.createElement('a')\n    if (isUndefined(location)) {\n        return null\n    }\n\n    location.href = url\n    return location\n}\n\nexport const formDataToQuery = function (formdata: Record<string, any> | FormData, arg_separator = '&'): string {\n    let use_val: string\n    let use_key: string\n    const tph_arr: string[] = []\n\n    each(formdata, function (val: File | string | undefined, key: string | undefined) {\n        // the key might be literally the string undefined for e.g. if {undefined: 'something'}\n        if (isUndefined(val) || isUndefined(key) || key === 'undefined') {\n            return\n        }\n\n        use_val = encodeURIComponent(isFile(val) ? val.name : val.toString())\n        use_key = encodeURIComponent(key)\n        tph_arr[tph_arr.length] = use_key + '=' + use_val\n    })\n\n    return tph_arr.join(arg_separator)\n}\n\n// NOTE: Once we get rid of IE11/op_mini we can start using URLSearchParams\nexport const getQueryParam = function (url: string, param: string): string {\n    const withoutHash: string = url.split('#')[0] || ''\n\n    // Split only on the first ? to sort problem out for those with multiple ?s\n    // and then remove them\n    const queryParams: string = withoutHash.split(/\\?(.*)/)[1] || ''\n    const cleanedQueryParams = queryParams.replace(/^\\?+/g, '')\n\n    const queryParts = cleanedQueryParams.split('&')\n    let keyValuePair\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const parts = queryParts[i].split('=')\n        if (parts[0] === param) {\n            keyValuePair = parts\n            break\n        }\n    }\n\n    if (!isArray(keyValuePair) || keyValuePair.length < 2) {\n        return ''\n    } else {\n        let result = keyValuePair[1]\n        try {\n            result = decodeURIComponent(result)\n        } catch {\n            logger.error('Skipping decoding for malformed query param: ' + result)\n        }\n        return result.replace(/\\+/g, ' ')\n    }\n}\n\n// replace any query params in the url with the provided mask value. Tries to keep the URL as instant as possible,\n// including preserving malformed text in most cases\nexport const maskQueryParams = function <T extends string | undefined>(\n    url: T,\n    maskedParams: string[] | undefined,\n    mask: string\n): T extends string ? string : undefined {\n    if (!url || !maskedParams || !maskedParams.length) {\n        return url as any\n    }\n\n    const splitHash = url.split('#')\n    const withoutHash: string = splitHash[0] || ''\n    const hash = splitHash[1]\n\n    const splitQuery: string[] = withoutHash.split('?')\n    const queryString: string = splitQuery[1]\n    const urlWithoutQueryAndHash: string = splitQuery[0]\n    const queryParts = (queryString || '').split('&')\n\n    // use an array of strings rather than an object to preserve ordering and duplicates\n    const paramStrings: string[] = []\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const keyValuePair = queryParts[i].split('=')\n        if (!isArray(keyValuePair)) {\n            continue\n        } else if (maskedParams.includes(keyValuePair[0])) {\n            paramStrings.push(keyValuePair[0] + '=' + mask)\n        } else {\n            paramStrings.push(queryParts[i])\n        }\n    }\n\n    let result = urlWithoutQueryAndHash\n    if (queryString != null) {\n        result += '?' + paramStrings.join('&')\n    }\n    if (hash != null) {\n        result += '#' + hash\n    }\n\n    return result as any\n}\n\nexport const _getHashParam = function (hash: string, param: string): string | null {\n    const matches = hash.match(new RegExp(param + '=([^&]*)'))\n    return matches ? matches[1] : null\n}\n\nexport const isLocalhost = (): boolean => {\n    return localDomains.includes(location.hostname)\n}\n","import { isFunction, isUndefined } from './type-utils'\nimport { includes } from './string-utils'\n\n/**\n * this device detection code is (at time of writing) about 3% of the size of the entire library\n * this is mostly because the identifiers user in regexes and results can't be minified away since\n * they have meaning\n *\n * so, there are some pre-uglifying choices in the code to help reduce the size\n * e.g. many repeated strings are stored as variables and then old-fashioned concatenated together\n *\n * TL;DR here be dragons\n */\nconst FACEBOOK = 'Facebook'\nconst MOBILE = 'Mobile'\nconst IOS = 'iOS'\nconst ANDROID = 'Android'\nconst TABLET = 'Tablet'\nconst ANDROID_TABLET = ANDROID + ' ' + TABLET\nconst IPAD = 'iPad'\nconst APPLE = 'Apple'\nconst APPLE_WATCH = APPLE + ' Watch'\nconst SAFARI = 'Safari'\nconst BLACKBERRY = 'BlackBerry'\nconst SAMSUNG = 'Samsung'\nconst SAMSUNG_BROWSER = SAMSUNG + 'Browser'\nconst SAMSUNG_INTERNET = SAMSUNG + ' Internet'\nconst CHROME = 'Chrome'\nconst CHROME_OS = CHROME + ' OS'\nconst CHROME_IOS = CHROME + ' ' + IOS\nconst INTERNET_EXPLORER = 'Internet Explorer'\nconst INTERNET_EXPLORER_MOBILE = INTERNET_EXPLORER + ' ' + MOBILE\nconst OPERA = 'Opera'\nconst OPERA_MINI = OPERA + ' Mini'\nconst EDGE = 'Edge'\nconst MICROSOFT_EDGE = 'Microsoft ' + EDGE\nconst FIREFOX = 'Firefox'\nconst FIREFOX_IOS = FIREFOX + ' ' + IOS\nconst NINTENDO = 'Nintendo'\nconst PLAYSTATION = 'PlayStation'\nconst XBOX = 'Xbox'\nconst ANDROID_MOBILE = ANDROID + ' ' + MOBILE\nconst MOBILE_SAFARI = MOBILE + ' ' + SAFARI\nconst WINDOWS = 'Windows'\nconst WINDOWS_PHONE = WINDOWS + ' Phone'\nconst NOKIA = 'Nokia'\nconst OUYA = 'Ouya'\nconst GENERIC = 'Generic'\nconst GENERIC_MOBILE = GENERIC + ' ' + MOBILE.toLowerCase()\nconst GENERIC_TABLET = GENERIC + ' ' + TABLET.toLowerCase()\nconst KONQUEROR = 'Konqueror'\n\nconst BROWSER_VERSION_REGEX_SUFFIX = '(\\\\d+(\\\\.\\\\d+)?)'\nconst DEFAULT_BROWSER_VERSION_REGEX = new RegExp('Version/' + BROWSER_VERSION_REGEX_SUFFIX)\n\nconst XBOX_REGEX = new RegExp(XBOX, 'i')\nconst PLAYSTATION_REGEX = new RegExp(PLAYSTATION + ' \\\\w+', 'i')\nconst NINTENDO_REGEX = new RegExp(NINTENDO + ' \\\\w+', 'i')\nconst BLACKBERRY_REGEX = new RegExp(BLACKBERRY + '|PlayBook|BB10', 'i')\n\nconst windowsVersionMap: Record<string, string> = {\n    'NT3.51': 'NT 3.11',\n    'NT4.0': 'NT 4.0',\n    '5.0': '2000',\n    '5.1': 'XP',\n    '5.2': 'XP',\n    '6.0': 'Vista',\n    '6.1': '7',\n    '6.2': '8',\n    '6.3': '8.1',\n    '6.4': '10',\n    '10.0': '10',\n}\n\n/**\n * Safari detection turns out to be complicated. For e.g. https://stackoverflow.com/a/29696509\n * We can be slightly loose because some options have been ruled out (e.g. firefox on iOS)\n * before this check is made\n */\nfunction isSafari(userAgent: string): boolean {\n    return includes(userAgent, SAFARI) && !includes(userAgent, CHROME) && !includes(userAgent, ANDROID)\n}\n\nconst safariCheck = (ua: string, vendor?: string) => (vendor && includes(vendor, APPLE)) || isSafari(ua)\n\n/**\n * This function detects which browser is running this script.\n * The order of the checks are important since many user agents\n * include keywords used in later checks.\n */\nexport const detectBrowser = function (user_agent: string, vendor: string | undefined): string {\n    vendor = vendor || '' // vendor is undefined for at least IE9\n\n    if (includes(user_agent, ' OPR/') && includes(user_agent, 'Mini')) {\n        return OPERA_MINI\n    } else if (includes(user_agent, ' OPR/')) {\n        return OPERA\n    } else if (BLACKBERRY_REGEX.test(user_agent)) {\n        return BLACKBERRY\n    } else if (includes(user_agent, 'IE' + MOBILE) || includes(user_agent, 'WPDesktop')) {\n        return INTERNET_EXPLORER_MOBILE\n    }\n    // https://developer.samsung.com/internet/user-agent-string-format\n    else if (includes(user_agent, SAMSUNG_BROWSER)) {\n        return SAMSUNG_INTERNET\n    } else if (includes(user_agent, EDGE) || includes(user_agent, 'Edg/')) {\n        return MICROSOFT_EDGE\n    } else if (includes(user_agent, 'FBIOS')) {\n        return FACEBOOK + ' ' + MOBILE\n    } else if (includes(user_agent, 'UCWEB') || includes(user_agent, 'UCBrowser')) {\n        return 'UC Browser'\n    } else if (includes(user_agent, 'CriOS')) {\n        return CHROME_IOS // why not just Chrome?\n    } else if (includes(user_agent, 'CrMo')) {\n        return CHROME\n    } else if (includes(user_agent, CHROME)) {\n        return CHROME\n    } else if (includes(user_agent, ANDROID) && includes(user_agent, SAFARI)) {\n        return ANDROID_MOBILE\n    } else if (includes(user_agent, 'FxiOS')) {\n        return FIREFOX_IOS\n    } else if (includes(user_agent.toLowerCase(), KONQUEROR.toLowerCase())) {\n        return KONQUEROR\n    } else if (safariCheck(user_agent, vendor)) {\n        return includes(user_agent, MOBILE) ? MOBILE_SAFARI : SAFARI\n    } else if (includes(user_agent, FIREFOX)) {\n        return FIREFOX\n    } else if (includes(user_agent, 'MSIE') || includes(user_agent, 'Trident/')) {\n        return INTERNET_EXPLORER\n    } else if (includes(user_agent, 'Gecko')) {\n        return FIREFOX\n    }\n\n    return ''\n}\n\nconst versionRegexes: Record<string, RegExp[]> = {\n    [INTERNET_EXPLORER_MOBILE]: [new RegExp('rv:' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [MICROSOFT_EDGE]: [new RegExp(EDGE + '?\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [CHROME]: [new RegExp('(' + CHROME + '|CrMo)\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [CHROME_IOS]: [new RegExp('CriOS\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    'UC Browser': [new RegExp('(UCBrowser|UCWEB)\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [SAFARI]: [DEFAULT_BROWSER_VERSION_REGEX],\n    [MOBILE_SAFARI]: [DEFAULT_BROWSER_VERSION_REGEX],\n    [OPERA]: [new RegExp('(' + OPERA + '|OPR)\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [FIREFOX]: [new RegExp(FIREFOX + '\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [FIREFOX_IOS]: [new RegExp('FxiOS\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [KONQUEROR]: [new RegExp('Konqueror[:/]?' + BROWSER_VERSION_REGEX_SUFFIX, 'i')],\n    // not every blackberry user agent has the version after the name\n    [BLACKBERRY]: [new RegExp(BLACKBERRY + ' ' + BROWSER_VERSION_REGEX_SUFFIX), DEFAULT_BROWSER_VERSION_REGEX],\n    [ANDROID_MOBILE]: [new RegExp('android\\\\s' + BROWSER_VERSION_REGEX_SUFFIX, 'i')],\n    [SAMSUNG_INTERNET]: [new RegExp(SAMSUNG_BROWSER + '\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [INTERNET_EXPLORER]: [new RegExp('(rv:|MSIE )' + BROWSER_VERSION_REGEX_SUFFIX)],\n    Mozilla: [new RegExp('rv:' + BROWSER_VERSION_REGEX_SUFFIX)],\n}\n\n/**\n * This function detects which browser version is running this script,\n * parsing major and minor version (e.g., 42.1). User agent strings from:\n * http://www.useragentstring.com/pages/useragentstring.php\n *\n * `navigator.vendor` is passed in and used to help with detecting certain browsers\n * NB `navigator.vendor` is deprecated and not present in every browser\n */\nexport const detectBrowserVersion = function (userAgent: string, vendor: string | undefined): number | null {\n    const browser = detectBrowser(userAgent, vendor)\n    const regexes: RegExp[] | undefined = versionRegexes[browser as keyof typeof versionRegexes]\n    if (isUndefined(regexes)) {\n        return null\n    }\n\n    for (let i = 0; i < regexes.length; i++) {\n        const regex = regexes[i]\n        const matches = userAgent.match(regex)\n        if (matches) {\n            return parseFloat(matches[matches.length - 2])\n        }\n    }\n    return null\n}\n\n// to avoid repeating regexes or calling them twice, we have an array of matches\n// the first regex that matches uses its matcher function to return the result\nconst osMatchers: [\n    RegExp,\n    [string, string] | ((match: RegExpMatchArray | null, user_agent: string) => [string, string]),\n][] = [\n    [\n        new RegExp(XBOX + '; ' + XBOX + ' (.*?)[);]', 'i'),\n        (match) => {\n            return [XBOX, (match && match[1]) || '']\n        },\n    ],\n    [new RegExp(NINTENDO, 'i'), [NINTENDO, '']],\n    [new RegExp(PLAYSTATION, 'i'), [PLAYSTATION, '']],\n    [BLACKBERRY_REGEX, [BLACKBERRY, '']],\n    [\n        new RegExp(WINDOWS, 'i'),\n        (_, user_agent) => {\n            if (/Phone/.test(user_agent) || /WPDesktop/.test(user_agent)) {\n                return [WINDOWS_PHONE, '']\n            }\n            // not all JS versions support negative lookbehind, so we need two checks here\n            if (new RegExp(MOBILE).test(user_agent) && !/IEMobile\\b/.test(user_agent)) {\n                return [WINDOWS + ' ' + MOBILE, '']\n            }\n            const match = /Windows NT ([0-9.]+)/i.exec(user_agent)\n            if (match && match[1]) {\n                const version = match[1]\n                let osVersion = windowsVersionMap[version] || ''\n                if (/arm/i.test(user_agent)) {\n                    osVersion = 'RT'\n                }\n                return [WINDOWS, osVersion]\n            }\n            return [WINDOWS, '']\n        },\n    ],\n    [\n        /((iPhone|iPad|iPod).*?OS (\\d+)_(\\d+)_?(\\d+)?|iPhone)/,\n        (match) => {\n            if (match && match[3]) {\n                const versionParts = [match[3], match[4], match[5] || '0']\n                return [IOS, versionParts.join('.')]\n            }\n            return [IOS, '']\n        },\n    ],\n    [\n        /(watch.*\\/(\\d+\\.\\d+\\.\\d+)|watch os,(\\d+\\.\\d+),)/i,\n        (match) => {\n            // e.g. Watch4,3/5.3.8 (16U680)\n            let version = ''\n            if (match && match.length >= 3) {\n                version = isUndefined(match[2]) ? match[3] : match[2]\n            }\n            return ['watchOS', version]\n        },\n    ],\n    [\n        new RegExp('(' + ANDROID + ' (\\\\d+)\\\\.(\\\\d+)\\\\.?(\\\\d+)?|' + ANDROID + ')', 'i'),\n        (match) => {\n            if (match && match[2]) {\n                const versionParts = [match[2], match[3], match[4] || '0']\n                return [ANDROID, versionParts.join('.')]\n            }\n            return [ANDROID, '']\n        },\n    ],\n    [\n        /Mac OS X (\\d+)[_.](\\d+)[_.]?(\\d+)?/i,\n        (match) => {\n            const result: [string, string] = ['Mac OS X', '']\n            if (match && match[1]) {\n                const versionParts = [match[1], match[2], match[3] || '0']\n                result[1] = versionParts.join('.')\n            }\n            return result\n        },\n    ],\n    [\n        /Mac/i,\n        // mop up a few non-standard UAs that should match mac\n        ['Mac OS X', ''],\n    ],\n    [/CrOS/, [CHROME_OS, '']],\n    [/Linux|debian/i, ['Linux', '']],\n]\n\nexport const detectOS = function (user_agent: string): [string, string] {\n    for (let i = 0; i < osMatchers.length; i++) {\n        const [rgex, resultOrFn] = osMatchers[i]\n        const match = rgex.exec(user_agent)\n        const result = match && (isFunction(resultOrFn) ? resultOrFn(match, user_agent) : resultOrFn)\n        if (result) {\n            return result\n        }\n    }\n    return ['', '']\n}\n\nexport const detectDevice = function (user_agent: string): string {\n    if (NINTENDO_REGEX.test(user_agent)) {\n        return NINTENDO\n    } else if (PLAYSTATION_REGEX.test(user_agent)) {\n        return PLAYSTATION\n    } else if (XBOX_REGEX.test(user_agent)) {\n        return XBOX\n    } else if (new RegExp(OUYA, 'i').test(user_agent)) {\n        return OUYA\n    } else if (new RegExp('(' + WINDOWS_PHONE + '|WPDesktop)', 'i').test(user_agent)) {\n        return WINDOWS_PHONE\n    } else if (/iPad/.test(user_agent)) {\n        return IPAD\n    } else if (/iPod/.test(user_agent)) {\n        return 'iPod Touch'\n    } else if (/iPhone/.test(user_agent)) {\n        return 'iPhone'\n    } else if (/(watch)(?: ?os[,/]|\\d,\\d\\/)[\\d.]+/i.test(user_agent)) {\n        return APPLE_WATCH\n    } else if (BLACKBERRY_REGEX.test(user_agent)) {\n        return BLACKBERRY\n    } else if (/(kobo)\\s(ereader|touch)/i.test(user_agent)) {\n        return 'Kobo'\n    } else if (new RegExp(NOKIA, 'i').test(user_agent)) {\n        return NOKIA\n    } else if (\n        // Kindle Fire without Silk / Echo Show\n        /(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\\))/i.test(user_agent) ||\n        // Kindle Fire HD\n        /(kf[a-z]+)( bui|\\)).+silk\\//i.test(user_agent)\n    ) {\n        return 'Kindle Fire'\n    } else if (/(Android|ZTE)/i.test(user_agent)) {\n        if (\n            !new RegExp(MOBILE).test(user_agent) ||\n            /(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(user_agent)\n        ) {\n            if (\n                (/pixel[\\daxl ]{1,6}/i.test(user_agent) && !/pixel c/i.test(user_agent)) ||\n                /(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(user_agent) ||\n                (/lmy47v/i.test(user_agent) && !/QTAQZ3/i.test(user_agent))\n            ) {\n                return ANDROID\n            }\n            return ANDROID_TABLET\n        } else {\n            return ANDROID\n        }\n    } else if (new RegExp('(pda|' + MOBILE + ')', 'i').test(user_agent)) {\n        return GENERIC_MOBILE\n    } else if (new RegExp(TABLET, 'i').test(user_agent) && !new RegExp(TABLET + ' pc', 'i').test(user_agent)) {\n        return GENERIC_TABLET\n    } else {\n        return ''\n    }\n}\n\nexport const detectDeviceType = function (user_agent: string): string {\n    const device = detectDevice(user_agent)\n    if (\n        device === IPAD ||\n        device === ANDROID_TABLET ||\n        device === 'Kobo' ||\n        device === 'Kindle Fire' ||\n        device === GENERIC_TABLET\n    ) {\n        return TABLET\n    } else if (device === NINTENDO || device === XBOX || device === PLAYSTATION || device === OUYA) {\n        return 'Console'\n    } else if (device === APPLE_WATCH) {\n        return 'Wearable'\n    } else if (device) {\n        return MOBILE\n    } else {\n        return 'Desktop'\n    }\n}\n","import { convertToURL, getQueryParam, maskQueryParams } from './request-utils'\nimport { isNull } from './type-utils'\nimport { Properties } from '../types'\nimport Config from '../config'\nimport { each, extend, extendArray, stripEmptyProperties } from './index'\nimport { document, location, userAgent, window } from './globals'\nimport { detectBrowser, detectBrowserVersion, detectDevice, detectDeviceType, detectOS } from './user-agent-utils'\nimport { stripLeadingDollar } from './string-utils'\n\nconst URL_REGEX_PREFIX = 'https?://(.*)'\n\n// CAMPAIGN_PARAMS and EVENT_TO_PERSON_PROPERTIES should be kept in sync with\n// https://github.com/PostHog/posthog/blob/master/plugin-server/src/utils/db/utils.ts#L60\n\n// The list of campaign parameters that could be considered personal data under e.g. GDPR.\n// These can be masked in URLs and properties before being sent to posthog.\nexport const PERSONAL_DATA_CAMPAIGN_PARAMS = [\n    'gclid', // google ads\n    'gclsrc', // google ads 360\n    'dclid', // google display ads\n    'gbraid', // google ads, web to app\n    'wbraid', // google ads, app to web\n    'fbclid', // facebook\n    'msclkid', // microsoft\n    'twclid', // twitter\n    'li_fat_id', // linkedin\n    'igshid', // instagram\n    'ttclid', // tiktok\n    'rdt_cid', // reddit\n    'epik', // pinterest\n    'qclid', // quora\n    'sccid', // snapchat\n    'irclid', // impact\n    '_kx', // klaviyo\n]\n\nexport const CAMPAIGN_PARAMS = extendArray(\n    [\n        'utm_source',\n        'utm_medium',\n        'utm_campaign',\n        'utm_content',\n        'utm_term',\n        'gad_source', // google ads source\n        'mc_cid', // mailchimp campaign id\n    ],\n    PERSONAL_DATA_CAMPAIGN_PARAMS\n)\n\nexport const EVENT_TO_PERSON_PROPERTIES = [\n    // mobile params\n    '$app_build',\n    '$app_name',\n    '$app_namespace',\n    '$app_version',\n    // web params\n    '$browser',\n    '$browser_version',\n    '$device_type',\n    '$current_url',\n    '$pathname',\n    '$os',\n    '$os_name', // $os_name is a special case, it's treated as an alias of $os!\n    '$os_version',\n    '$referring_domain',\n    '$referrer',\n    '$screen_height',\n    '$screen_width',\n    '$viewport_height',\n    '$viewport_width',\n    '$raw_user_agent',\n]\n\nexport const MASKED = '<masked>'\n\nexport function getCampaignParams(\n    customTrackedParams?: string[],\n    maskPersonalDataProperties?: boolean,\n    customPersonalDataProperties?: string[] | undefined\n): Record<string, string> {\n    if (!document) {\n        return {}\n    }\n\n    const paramsToMask = maskPersonalDataProperties\n        ? extendArray([], PERSONAL_DATA_CAMPAIGN_PARAMS, customPersonalDataProperties || [])\n        : []\n\n    return _getCampaignParamsFromUrl(maskQueryParams(document.URL, paramsToMask, MASKED), customTrackedParams)\n}\n\nfunction _getCampaignParamsFromUrl(url: string, customParams?: string[]): Record<string, string> {\n    const campaign_keywords = CAMPAIGN_PARAMS.concat(customParams || [])\n\n    const params: Record<string, any> = {}\n    each(campaign_keywords, function (kwkey) {\n        const kw = getQueryParam(url, kwkey)\n        params[kwkey] = kw ? kw : null\n    })\n\n    return params\n}\n\nfunction _getSearchEngine(referrer: string): string | null {\n    if (!referrer) {\n        return null\n    } else {\n        if (referrer.search(URL_REGEX_PREFIX + 'google.([^/?]*)') === 0) {\n            return 'google'\n        } else if (referrer.search(URL_REGEX_PREFIX + 'bing.com') === 0) {\n            return 'bing'\n        } else if (referrer.search(URL_REGEX_PREFIX + 'yahoo.com') === 0) {\n            return 'yahoo'\n        } else if (referrer.search(URL_REGEX_PREFIX + 'duckduckgo.com') === 0) {\n            return 'duckduckgo'\n        } else {\n            return null\n        }\n    }\n}\n\nfunction _getSearchInfoFromReferrer(referrer: string): Record<string, any> {\n    const search = _getSearchEngine(referrer)\n    const param = search != 'yahoo' ? 'q' : 'p'\n    const ret: Record<string, any> = {}\n\n    if (!isNull(search)) {\n        ret['$search_engine'] = search\n\n        const keyword = document ? getQueryParam(document.referrer, param) : ''\n        if (keyword.length) {\n            ret['ph_keyword'] = keyword\n        }\n    }\n\n    return ret\n}\n\nexport function getSearchInfo(): Record<string, any> {\n    const referrer = document?.referrer\n    if (!referrer) {\n        return {}\n    }\n    return _getSearchInfoFromReferrer(referrer)\n}\n\nexport function getBrowserLanguage(): string | undefined {\n    return (\n        navigator.language || // Any modern browser\n        (navigator as Record<string, any>).userLanguage // IE11\n    )\n}\n\nexport function getBrowserLanguagePrefix(): string | undefined {\n    const lang = getBrowserLanguage()\n    return typeof lang === 'string' ? lang.split('-')[0] : undefined\n}\n\nexport function getReferrer(): string {\n    return document?.referrer || '$direct'\n}\n\nexport function getReferringDomain(): string {\n    if (!document?.referrer) {\n        return '$direct'\n    }\n    return convertToURL(document.referrer)?.host || '$direct'\n}\n\nexport function getReferrerInfo(): Record<string, any> {\n    return {\n        $referrer: getReferrer(),\n        $referring_domain: getReferringDomain(),\n    }\n}\n\nexport function getPersonInfo(maskPersonalDataProperties?: boolean, customPersonalDataProperties?: string[]) {\n    const paramsToMask = maskPersonalDataProperties\n        ? extendArray([], PERSONAL_DATA_CAMPAIGN_PARAMS, customPersonalDataProperties || [])\n        : []\n    const url = location?.href.substring(0, 1000)\n    // we're being a bit more economical with bytes here because this is stored in the cookie\n    return {\n        r: getReferrer().substring(0, 1000),\n        u: url ? maskQueryParams(url, paramsToMask, MASKED) : undefined,\n    }\n}\n\nexport function getPersonPropsFromInfo(info: Record<string, any>): Record<string, any> {\n    const { r: referrer, u: url } = info\n    const referring_domain =\n        referrer == null ? undefined : referrer == '$direct' ? '$direct' : convertToURL(referrer)?.host\n\n    const props: Record<string, string | undefined> = {\n        $referrer: referrer,\n        $referring_domain: referring_domain,\n    }\n    if (url) {\n        props['$current_url'] = url\n        const location = convertToURL(url)\n        props['$host'] = location?.host\n        props['$pathname'] = location?.pathname\n        const campaignParams = _getCampaignParamsFromUrl(url)\n        extend(props, campaignParams)\n    }\n    if (referrer) {\n        const searchInfo = _getSearchInfoFromReferrer(referrer)\n        extend(props, searchInfo)\n    }\n    return props\n}\n\nexport function getInitialPersonPropsFromInfo(info: Record<string, any>): Record<string, any> {\n    const personProps = getPersonPropsFromInfo(info)\n    const props: Record<string, any> = {}\n    each(personProps, function (val: any, key: string) {\n        props[`$initial_${stripLeadingDollar(key)}`] = val\n    })\n    return props\n}\n\nexport function getTimezone(): string | undefined {\n    try {\n        return Intl.DateTimeFormat().resolvedOptions().timeZone\n    } catch {\n        return undefined\n    }\n}\n\nexport function getTimezoneOffset(): number | undefined {\n    try {\n        return new Date().getTimezoneOffset()\n    } catch {\n        return undefined\n    }\n}\n\nexport function getEventProperties(\n    maskPersonalDataProperties?: boolean,\n    customPersonalDataProperties?: string[]\n): Properties {\n    if (!userAgent) {\n        return {}\n    }\n    const paramsToMask = maskPersonalDataProperties\n        ? extendArray([], PERSONAL_DATA_CAMPAIGN_PARAMS, customPersonalDataProperties || [])\n        : []\n    const [os_name, os_version] = detectOS(userAgent)\n    return extend(\n        stripEmptyProperties({\n            $os: os_name,\n            $os_version: os_version,\n            $browser: detectBrowser(userAgent, navigator.vendor),\n            $device: detectDevice(userAgent),\n            $device_type: detectDeviceType(userAgent),\n            $timezone: getTimezone(),\n            $timezone_offset: getTimezoneOffset(),\n        }),\n        {\n            $current_url: maskQueryParams(location?.href, paramsToMask, MASKED),\n            $host: location?.host,\n            $pathname: location?.pathname,\n            $raw_user_agent: userAgent.length > 1000 ? userAgent.substring(0, 997) + '...' : userAgent,\n            $browser_version: detectBrowserVersion(userAgent, navigator.vendor),\n            $browser_language: getBrowserLanguage(),\n            $browser_language_prefix: getBrowserLanguagePrefix(),\n            $screen_height: window?.screen.height,\n            $screen_width: window?.screen.width,\n            $viewport_height: window?.innerHeight,\n            $viewport_width: window?.innerWidth,\n            $lib: 'web',\n            $lib_version: Config.LIB_VERSION,\n            $insert_id: Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10),\n            $time: Date.now() / 1000, // epoch time in seconds\n        }\n    )\n}\n","import { isNumber } from './type-utils'\nimport { logger } from './logger'\n\n/**\n * Clamps a value to a range.\n * @param value the value to clamp\n * @param min the minimum value\n * @param max the maximum value\n * @param label if provided then enables logging and prefixes all logs with labels\n * @param fallbackValue if provided then returns this value if the value is not a valid number\n */\nexport function clampToRange(value: unknown, min: number, max: number, label?: string, fallbackValue?: number): number {\n    if (min > max) {\n        logger.warn('min cannot be greater than max.')\n        min = max\n    }\n\n    if (!isNumber(value)) {\n        label &&\n            logger.warn(\n                label + ' must be a number. using max or fallback. max: ' + max + ', fallback: ' + fallbackValue\n            )\n        return clampToRange(fallbackValue || max, min, max, label)\n    } else if (value > max) {\n        label && logger.warn(label + ' cannot be  greater than max: ' + max + '. Using max value instead.')\n        return max\n    } else if (value < min) {\n        label && logger.warn(label + ' cannot be less than min: ' + min + '. Using min value instead.')\n        return min\n    } else {\n        return value\n    }\n}\n","import { clampToRange } from '../utils/number-utils'\nimport { isArray, isUndefined } from '../utils/type-utils'\n\nexport function appendArray(currentValue: string[] | undefined, sampleType: string | string[]): string[] {\n    return [...(currentValue ? currentValue : []), ...(isArray(sampleType) ? sampleType : [sampleType])]\n}\n\nexport function updateThreshold(currentValue: number | undefined, percent: number): number {\n    return (isUndefined(currentValue) ? 1 : currentValue) * percent\n}\n\nexport function simpleHash(str: string) {\n    let hash = 0\n    for (let i = 0; i < str.length; i++) {\n        hash = (hash << 5) - hash + str.charCodeAt(i) // (hash * 31) + char code\n        hash |= 0 // Convert to 32bit integer\n    }\n    return Math.abs(hash)\n}\n\n/*\n * receives percent as a number between 0 and 1\n */\nexport function sampleOnProperty(prop: string, percent: number): boolean {\n    return simpleHash(prop) % 100 < clampToRange(percent * 100, 0, 100)\n}\n","import { clampToRange } from '../utils/number-utils'\nimport { BeforeSendFn, CaptureResult, KnownEventName } from '../types'\nimport { includes } from '../utils/string-utils'\nimport { appendArray, sampleOnProperty, updateThreshold } from '../extensions/sampling'\n\n/**\n * Provides an implementation of sampling that samples based on the distinct ID.\n * Using the provided percentage.\n * Can be used to create a beforeCapture fn for a PostHog instance.\n *\n * Setting 0.5 will cause roughly 50% of distinct ids to have events sent.\n * Not 50% of events for each distinct id.\n *\n * @param percent a number from 0 to 1, 1 means always send and, 0 means never send the event\n */\nexport function sampleByDistinctId(percent: number): BeforeSendFn {\n    return (captureResult: CaptureResult | null): CaptureResult | null => {\n        if (!captureResult) {\n            return null\n        }\n\n        return sampleOnProperty(captureResult.properties.distinct_id, percent)\n            ? {\n                  ...captureResult,\n                  properties: {\n                      ...captureResult.properties,\n                      $sample_type: ['sampleByDistinctId'],\n                      $sample_threshold: percent,\n                  },\n              }\n            : null\n    }\n}\n\n/**\n * Provides an implementation of sampling that samples based on the session ID.\n * Using the provided percentage.\n * Can be used to create a beforeCapture fn for a PostHog instance.\n *\n * Setting 0.5 will cause roughly 50% of sessions to have events sent.\n * Not 50% of events for each session.\n *\n * @param percent a number from 0 to 1, 1 means always send and, 0 means never send the event\n */\nexport function sampleBySessionId(percent: number): BeforeSendFn {\n    return (captureResult: CaptureResult | null): CaptureResult | null => {\n        if (!captureResult) {\n            return null\n        }\n\n        return sampleOnProperty(captureResult.properties.$session_id, percent)\n            ? {\n                  ...captureResult,\n                  properties: {\n                      ...captureResult.properties,\n                      $sample_type: appendArray(captureResult.properties.$sample_type, 'sampleBySessionId'),\n                      $sample_threshold: updateThreshold(captureResult.properties.$sample_threshold, percent),\n                  },\n              }\n            : null\n    }\n}\n\n/**\n * Provides an implementation of sampling that samples based on the event name.\n * Using the provided percentage.\n * Can be used to create a beforeCapture fn for a PostHog instance.\n *\n * @param eventNames an array of event names to sample, sampling is applied across events not per event name\n * @param percent a number from 0 to 1, 1 means always send, 0 means never send the event\n */\nexport function sampleByEvent(eventNames: KnownEventName[], percent: number): BeforeSendFn {\n    return (captureResult: CaptureResult | null): CaptureResult | null => {\n        if (!captureResult) {\n            return null\n        }\n\n        if (!includes(eventNames, captureResult.event)) {\n            return captureResult\n        }\n\n        const number = Math.random()\n        return number * 100 < clampToRange(percent * 100, 0, 100)\n            ? {\n                  ...captureResult,\n                  properties: {\n                      ...captureResult.properties,\n                      $sample_type: appendArray(captureResult.properties?.$sample_type, 'sampleByEvent'),\n                      $sample_threshold: updateThreshold(captureResult.properties?.$sample_threshold, percent),\n                      $sampled_events: appendArray(captureResult.properties?.$sampled_events, eventNames),\n                  },\n              }\n            : null\n    }\n}\n\nexport const printAndDropEverything: BeforeSendFn = (result) => {\n    // eslint-disable-next-line no-console\n    console.log('Would have sent event:', result)\n    return null\n}\n","import { PostHog } from '../posthog-core'\nimport {\n    CAMPAIGN_PARAMS,\n    getCampaignParams,\n    EVENT_TO_PERSON_PROPERTIES,\n    getEventProperties,\n    getReferrerInfo,\n} from '../utils/event-utils'\nimport { each, extend } from '../utils'\nimport { includes } from '../utils/string-utils'\n\nexport const setAllPersonProfilePropertiesAsPersonPropertiesForFlags = (posthog: PostHog): void => {\n    const allProperties = extend(\n        {},\n        getEventProperties(\n            posthog.config.mask_personal_data_properties,\n            posthog.config.custom_personal_data_properties\n        ),\n        getCampaignParams(\n            posthog.config.custom_campaign_params,\n            posthog.config.mask_personal_data_properties,\n            posthog.config.custom_personal_data_properties\n        ),\n        getReferrerInfo()\n    )\n    const personProperties: Record<string, string> = {}\n    each(allProperties, function (v, k: string) {\n        if (includes(CAMPAIGN_PARAMS, k) || includes(EVENT_TO_PERSON_PROPERTIES, k)) {\n            personProperties[k] = v\n        }\n    })\n\n    posthog.setPersonPropertiesForFlags(personProperties)\n}\n","// this file is called customizations.full.ts because it includes all customizations\n// this naming scheme allows us to create a lighter version in the future with only the most popular customizations\n// without breaking backwards compatibility\n\nimport * as customizations from '../customizations'\nimport { assignableWindow } from '../utils/globals'\nassignableWindow.posthogCustomizations = customizations\n"],"names":["win","window","undefined","global","globalThis","nativeForEach","Array","prototype","forEach","navigator","document","location","fetch","XMLHttpRequest","AbortController","userAgent","assignableWindow","Config","DEBUG","LIB_VERSION","includes","str","needle","indexOf","nativeIsArray","isArray","ObjProto","Object","hasOwnProperty","toString","obj","call","isUndefined","x","isNullish","isNull","isNumber","isFormData","FormData","_createLogger","prefix","logger","_log","level","console","consoleLog","_len","arguments","length","args","_key","info","_len2","_key2","warn","_len3","_key3","error","_len4","_key4","critical","_len5","_key5","uninitializedWarning","methodName","createLogger","additionalPrefix","breaker","eachArray","iterator","thisArg","i","l","each","pair","entries","key","extend","source","prop","extendArray","item","push","stripEmptyProperties","p","ret","v","k","convertToURL","url","createElement","href","getQueryParam","param","keyValuePair","queryParts","split","replace","parts","result","decodeURIComponent","_unused","maskQueryParams","maskedParams","mask","splitHash","withoutHash","hash","splitQuery","queryString","urlWithoutQueryAndHash","paramStrings","join","MOBILE","IOS","ANDROID","TABLET","ANDROID_TABLET","IPAD","APPLE","APPLE_WATCH","SAFARI","BLACKBERRY","SAMSUNG","SAMSUNG_BROWSER","SAMSUNG_INTERNET","CHROME","CHROME_OS","CHROME_IOS","INTERNET_EXPLORER","INTERNET_EXPLORER_MOBILE","OPERA","OPERA_MINI","EDGE","MICROSOFT_EDGE","FIREFOX","FIREFOX_IOS","NINTENDO","PLAYSTATION","XBOX","ANDROID_MOBILE","MOBILE_SAFARI","WINDOWS","WINDOWS_PHONE","NOKIA","OUYA","GENERIC","GENERIC_MOBILE","toLowerCase","GENERIC_TABLET","KONQUEROR","BROWSER_VERSION_REGEX_SUFFIX","DEFAULT_BROWSER_VERSION_REGEX","RegExp","XBOX_REGEX","PLAYSTATION_REGEX","NINTENDO_REGEX","BLACKBERRY_REGEX","windowsVersionMap","safariCheck","ua","vendor","isSafari","detectBrowser","user_agent","test","FACEBOOK","versionRegexes","Mozilla","detectBrowserVersion","browser","regexes","regex","matches","match","parseFloat","osMatchers","_","exec","version","osVersion","versionParts","detectDevice","PERSONAL_DATA_CAMPAIGN_PARAMS","CAMPAIGN_PARAMS","EVENT_TO_PERSON_PROPERTIES","MASKED","getCampaignParams","customTrackedParams","maskPersonalDataProperties","customPersonalDataProperties","customParams","campaign_keywords","params","paramsToMask","URL","concat","kwkey","kw","getBrowserLanguage","language","userLanguage","getTimezone","Intl","DateTimeFormat","resolvedOptions","timeZone","getTimezoneOffset","Date","_unused2","getEventProperties","lang","device","os_name","os_version","rgex","resultOrFn","detectOS","$os","$os_version","$browser","$device","$device_type","$timezone","$timezone_offset","$current_url","$host","host","$pathname","pathname","$raw_user_agent","substring","$browser_version","$browser_language","$browser_language_prefix","$screen_height","screen","height","$screen_width","width","$viewport_height","innerHeight","$viewport_width","innerWidth","$lib","$lib_version","$insert_id","Math","random","$time","now","clampToRange","value","min","max","label","fallbackValue","appendArray","currentValue","sampleType","updateThreshold","percent","sampleOnProperty","charCodeAt","abs","simpleHash","log","captureResult","properties","distinct_id","_extends","$sample_type","$sample_threshold","eventNames","_captureResult$proper","_captureResult$proper2","_captureResult$proper3","event","$sampled_events","$session_id","posthog","_convertToURL","allProperties","config","mask_personal_data_properties","custom_personal_data_properties","custom_campaign_params","$referrer","referrer","$referring_domain","personProperties","setPersonPropertiesForFlags","posthogCustomizations","customizations"],"mappings":"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"}